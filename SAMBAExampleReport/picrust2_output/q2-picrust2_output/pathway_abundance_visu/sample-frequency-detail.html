<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>q2_feature_table : summarize</title>
    <link rel="stylesheet" href="./q2templateassets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/normalize.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/base-template.css"/>
    <script src="./q2templateassets/js/jquery-3.2.0.min.js" charset="utf-8"></script>
    <script src="./q2templateassets/js/bootstrap.min.js" charset="utf-8"></script>
    
<script src="js/vega.min.js"></script>
<script src="js/vega-embed.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/spinkit.css" /> 
  </head>
  <body>
    <div class="container-fluid">
      <div id="q2templatesheader" class="row">
        <div class="col-lg-12">
          <a href="http://qiime2.org/">
            <img src="./q2templateassets/img/qiime2-rect-200.png"
            alt="QIIME 2">
          </a>
        </div>
      </div>
        

  <div class="row">
    <div class="col-lg-12">
      <ul class="nav nav-tabs">
        
          <li class="">
            <a href="index.html">
              Overview
            </a>
          </li>
        
          <li class="active">
            <a href="sample-frequency-detail.html">
              Interactive Sample Detail
            </a>
          </li>
        
          <li class="">
            <a href="feature-frequency-detail.html">
              Feature Detail
            </a>
          </li>
        
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      


<div class="row">
  <div class="col-lg-4">
    <div class="row">
      <div class="col-lg-12" id="sampling-depth-slider">
        <label> Sampling Depth &nbsp; </label> <br>
        <input id="range-slider" type="range" min="0" max="11282124.098499998" value="0" class="slider" oninput="sliderHelperFunction(this.value);"> <br>
        <input id="text-box" class="form-control" type="number" value="0" min="0" oninput="textBoxHelperFunction(this.value);"/>
        <br>
        (zero implies no even sampling)
        <div class="row">
          <div class="col-lg-12" id="text-field"></div>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="row">
  <div class="col-lg-8">
    <table id="feature-table" class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Sample ID</th>
          <th scope="col">Feature Count</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
</div>

<script id="table-data" type="application/json">
{"Ppet15j1":11282124.0984999985,"Ppa15j3":11232256.5590000004,"Ppa21j3":11214003.893199997,"Ppa15j1":11079250.0579000115,"Ppa15j2":10984162.1188000031,"Ppa8j2":10388546.0250000004,"Ppet15j3":9900821.0566999894,"Ppet15j2":9889590.6625000108,"Ppa21j2":9474580.8091999982,"Ppet21j3":9192996.6479999963,"Ppet8j3":8607929.8397999946,"Ppa8j1":8377937.9309000056,"Ppa21j1":7920620.815200001,"Cpa8j3":7800015.3401000025,"Ppet8j2":7776516.6124999961,"Cpa15j2":7735706.769700001,"Ppet21j2":7709190.0975999953,"Ppet21j1":7429513.581199998,"Ppa5j1":7340641.0235999981,"Ppet8j1":7292912.5059999963,"Ppet18h2":7240615.9241000004,"Ppa5j3":7118493.8814999955,"Cpa21j1":7095690.0736000082,"Ppa5j2":7049264.2641000031,"Ppet5j2":6896924.3239000048,"Cpa8j2":6729940.1417000005,"Ppet5j3":6714577.055999998,"Cpet21j1":6557552.4059000006,"Ppa18h3":6549418.7841999987,"Ppet18h1":6502937.4230000023,"Cpa18h1":6479385.7416000012,"Ppet5j1":6385203.5454000058,"Cpet15j3":6378426.8319999995,"Cpa15j1":6336174.6597999996,"Ppet24h1":6262357.144600003,"Cpa21j3":6157920.7986000003,"Ppa18h2":6145626.5090000005,"Cpet21j2":6096375.864199996,"Cpa21j2":6090128.2250999985,"Cpet15j1":5935070.5221999995,"Cpet15j2":5830482.7873000037,"Cpet8j2":5680449.2640999993,"Cpet21j3":5627872.0075999992,"Cpa18h3":5611235.8281999994,"Ppet18h3":5527280.8905999959,"Cpa15j3":5511679.7936999975,"Cpa18h2":5511041.6442000037,"Cpet8j3":5481871.8043999951,"Ppet24h3":5459050.3467000024,"Cpet5j3":5442264.5514000012,"Cpet8j1":5398099.6848000037,"Cpa8j1":5175059.1560999984,"Ppa18h1":5164710.7703000028,"Cpa5j1":5159332.5648000007,"Cpa5j3":5140113.6353000021,"Cpet18h2":5036810.5874999994,"Ppet24h2":4959487.7876000023,"Ppa24h1":4915254.1404999997,"Ppa24h3":4622755.9452000046,"Cpa5j2":4607243.2786000008,"Ppa24h2":4523061.5567000015,"Cpa24h2":4506560.0064000012,"Cpet5j2":3804475.8189999987,"Cpet5j1":3531669.2246000008,"Cpet18h1":3467245.5408999999,"Cpa24h3":3333924.9548999993,"Cpet24h2":3162688.2090000007,"Cpet18h3":2877827.6410999983,"Cpa24h1":2433098.1009,"Cpet24h3":2425258.6684000012,"Cpet24h1":2322486.9896999993}
</script>

<script type="text/javascript">
  var totalFrequencies = 455601793;
  var sampleCount = 71;
  var defaultDescription = "Retained " + (totalFrequencies.toLocaleString('en'))
                                       + " (100.00%) features in "
                                       + sampleCount + " (100.00%) samples at the specifed sampling depth.";


  var textField = document.getElementById('text-field');
  var tableBody = document.getElementById("table-body");
  var table = document.getElementById("feature-table");

  // when the viz loads the default description is displayed
  textField.innerHTML = defaultDescription;

  var sampleFrequency = JSON.parse(document.getElementById("table-data").innerHTML);
  // get object keys and store them in an ascending order based on the key value
  // this order is used to create the table rows
  sortedSampleIDs = Object.keys(sampleFrequency).sort(function(a, b) {
    var temp = sampleFrequency[a] - sampleFrequency[b];
    // if two samples have the same number of features then we
    // determine the order using the sample ID alphabetical order
    if (temp == 0){
      return b.localeCompare(a);
    }

  return temp;
  });

  sortedSampleIDs.forEach(function(element) {
    var row = tableBody.insertRow(0);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    cell1.innerHTML = element;
    cell2.innerHTML = sampleFrequency[element];

  });


  function updateTableandText(val) {
    var retainedSampleCount = 0;

    // start the counter at 1 to ignore the header row
    for (var i = 1; row = table.rows[i]; i++) {

      if (Number(row.cells[1].innerHTML) < val) {
        row.className = "danger";
      } else {
        row.className = "";
        retainedSampleCount += 1;
      }
    }
    if (val == 0){

    textField.innerHTML = defaultDescription;

    }
    else{
      var retainedFeatureCount = retainedSampleCount * val;
      textField.innerHTML = "Retained " + retainedFeatureCount.toLocaleString('en')
                                        + " (" + (retainedFeatureCount/totalFrequencies*100).toFixed(2) + "%) features in "
                                        + retainedSampleCount + " (" + (retainedSampleCount/sampleCount*100).toFixed(2)
                                        +  "%) samples at the specifed sampling depth.";
    }

  }


  function updateSliderVal(val) {
    var slider = document.getElementById("range-slider");
    slider.value = val;
    slider.dispatchEvent(new Event("change"));
    slider.dispatchEvent(new Event("input"));
  }


  function updateBoxVal(val) {
    var num = document.getElementById("text-box");
    num.value = val;
  }


  function sliderHelperFunction(val){
    updateBoxVal(val);
    updateTableandText(val);

  }


  function textBoxHelperFunction(val){
    val = parseInt(val);
    if (val !== val) {
      val = 0;
    }

    // make sure the value in the textbox cannot exceed the max count
    if (val > 11282124.098499998){
      var num = document.getElementById("text-box");
      num.value = 11282124.098499998;
    }
    updateSliderVal(val);
  }
</script>


    </div>
  </div>


    </div>
    <script type="text/javascript">
      if (window.frameElement) {
          document.getElementById('q2templatesheader').remove();
      }
    </script>
    

  </body>
</html>